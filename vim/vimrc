" Default vim path ini all versions
set rtp +=~/.vim

" vim plug
if empty(glob('~/.vim/autoload/plug.vim'))
  silent !curl -fLo ~/.vim/autoload/plug.vim --create-dirs
        \ https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
    autocmd VimEnter * PlugInstall
endif

" Helper conditional install bundle
function! Cond(cond, ...)
  let opts = get(a:000, 0, {})
  return a:cond ? opts : extend(opts, { 'on': [], 'for': [] })
endfunction

" bundles
call plug#begin('~/.vim/plugged')
    for fpath in split(globpath('~/dotfiles/vim/bundles', '*.vim'), '\n')
        exe 'source' fpath
    endfor

    if filereadable(expand('~/.vim/bundles.vim'))
        source ~/.vim/bundles.vim
    endif
call plug#end()

" settings
for fpath in split(globpath('~/dotfiles/vim/settings', '*.vim'), '\n')
  exe 'source' fpath
endfor

if filereadable(expand('~/.vim/settings.vim'))
    source ~/.vim/settings.vim
endif

" map <silent> <leader>li :set list!<bar>set nolist?<cr>
map <silent> \hl :set hls!<bar>set nohls?<cr>

vnoremap <silent> <CR> "+y

" Spell
set spellcapcheck=[.?!]\_[\])'"^I ]\+
map <silent> \pt :set spell spelllang=pt<cr>
map <silent> \en :set spell spelllang=en<cr>
map <silent> \sp :set spell!<cr>

map <silent> \ns :set nospell<cr>

" When pressing <leader>cd switch to the directory of the open buffer
map <silent><leader>cd :cd %:p:h<CR>:pwd<CR>
" map <leader>cd :exec ":cd expand(%:p:h)"<CR>

" Toggle virtualedit
function! <SID>ToogleVirtualEditor()
    if &virtualedit == "all"
        set virtualedit=
    else
        set virtualedit=all
    endif
endfunction
noremap <silent><leader>v :call <SID>ToogleVirtualEditor()<CR>

" trim
fun! <SID>StripTrailingWhitespaces()
    let l = line(".")
    let c = col(".")
    %s/\s\+$//e
    call cursor(l, c)
endfun
map <silent>\tr :call <SID>StripTrailingWhitespaces()<CR>

" Shortcuts for nav tabs
map \bo :e<Space>
noremap <silent><cr> :b#<cr>
map <silent> <Tab> :bn<CR>
map <silent> <S-Tab> :bp<CR>

" Use C-q para seleção em bloco
noremap <C-v> <Nop>

" vim:noet:foldmethod=marker
